<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2182px" preserveAspectRatio="none" style="width:1018px;height:2182px;background:#FFFFFF;" version="1.1" viewBox="0 0 1018 2182" width="1018px" zoomAndPan="magnify"><defs><filter height="300%" id="faean7l67dzxi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="2170.2578" style="stroke:#A80036;stroke-width:1.0;" width="82" x="20" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76" x="23" y="19.4951">PaxosClient</text><rect fill="#90EE90" height="2170.2578" style="stroke:#A80036;stroke-width:1.0;" width="508.5" x="213.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81" x="427.25" y="19.4951">PaxosServer</text><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="274.8672" style="stroke:#A80036;stroke-width:1.0;" width="10" x="418" y="195.6641"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="282.5156" style="stroke:#A80036;stroke-width:1.0;" width="10" x="418" y="1254.9141"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="300.5703" style="stroke:#000000;stroke-width:2.0;" width="693" x="308" y="215.6641"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="419.8672" style="stroke:#000000;stroke-width:2.0;" width="632" x="309" y="530.2344"/><rect fill="#FFFFFF" height="203.3516" style="stroke:none;stroke-width:1.0;" width="632" x="309" y="746.75"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="934.1406" style="stroke:#000000;stroke-width:2.0;" width="912" x="10" y="1137.5078"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="858.4375" style="stroke:#000000;stroke-width:2.0;" width="892" x="20" y="1206.2109"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="270.5156" style="stroke:#000000;stroke-width:2.0;" width="594" x="308" y="1274.9141"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="262" x="630" y="1446.375"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="498.2188" style="stroke:#000000;stroke-width:2.0;" width="544" x="30" y="1559.4297"/><rect fill="#FFFFFF" height="281.7031" style="stroke:none;stroke-width:1.0;" width="544" x="30" y="1775.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61" x2="61" y1="110.9609" y2="957.1016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="61" x2="61" y1="957.1016" y2="985.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61" x2="61" y1="985.1016" y2="2088.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="251.5" x2="251.5" y1="110.9609" y2="957.1016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="251.5" x2="251.5" y1="957.1016" y2="985.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="251.5" x2="251.5" y1="985.1016" y2="2088.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="422.5" y1="110.9609" y2="957.1016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="422.5" x2="422.5" y1="957.1016" y2="985.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="422.5" y1="985.1016" y2="2088.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="110.9609" y2="957.1016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="679" x2="679" y1="957.1016" y2="985.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="679" y1="985.1016" y2="2088.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="40" y="107.8848">Client</text><ellipse cx="61" cy="36.3516" fill="#FEFECE" filter="url(#faean7l67dzxi)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M61,44.3516 L61,71.3516 M48,52.3516 L74,52.3516 M61,71.3516 L48,86.3516 M61,71.3516 L74,86.3516 " fill="none" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="40" y="2102.1816">Client</text><ellipse cx="61" cy="2115.2578" fill="#FEFECE" filter="url(#faean7l67dzxi)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M61,2123.2578 L61,2150.2578 M48,2131.2578 L74,2131.2578 M61,2150.2578 L48,2165.2578 M61,2150.2578 L74,2165.2578 " fill="none" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="221.5" y="70.3516"/><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="217.5" y="74.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="224.5" y="95.8848">Replica</text><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="221.5" y="2087.6484"/><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="217.5" y="2091.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="224.5" y="2113.1816">Replica</text><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="393.5" y="70.3516"/><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="389.5" y="74.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="396.5" y="95.8848">Leader</text><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="393.5" y="2087.6484"/><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="389.5" y="2091.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="396.5" y="2113.1816">Leader</text><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="644" y="70.3516"/><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="640" y="74.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="647" y="95.8848">Acceptor</text><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="644" y="2087.6484"/><rect fill="#FEFECE" filter="url(#faean7l67dzxi)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="640" y="2091.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="647" y="2113.1816">Acceptor</text><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="274.8672" style="stroke:#A80036;stroke-width:1.0;" width="10" x="418" y="195.6641"/><rect fill="#FFFFFF" filter="url(#faean7l67dzxi)" height="282.5156" style="stroke:#A80036;stroke-width:1.0;" width="10" x="418" y="1254.9141"/><rect fill="#EEEEEE" filter="url(#faean7l67dzxi)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1011" x="0" y="142.1367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1011" y1="142.1367" y2="142.1367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1011" y1="145.1367" y2="145.1367"/><rect fill="#EEEEEE" filter="url(#faean7l67dzxi)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="73" x="469" y="130.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="475" y="148.4561">PHASE 1</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423" x2="470" y1="182.6641" y2="182.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470" x2="470" y1="182.6641" y2="195.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="429" x2="470" y1="195.6641" y2="195.6641"/><polygon fill="#A80036" points="439,191.6641,429,195.6641,439,199.6641,435,195.6641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="435" y="177.8076">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="446" y="177.8076">Activate "Scout" stage.</text><path d="M308,215.6641 L381,215.6641 L381,223.6641 L371,233.6641 L308,233.6641 L308,215.6641 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="300.5703" style="stroke:#000000;stroke-width:2.0;" width="693" x="308" y="215.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="323" y="230.1592">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="387" x="396" y="229.083">[until at least half responses no greater than my ballot OR any greater]</text><path d="M318,239.0156 L318,314.0156 L524,314.0156 L524,249.0156 L514,239.0156 L318,239.0156 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,239.0156 L514,249.0156 L524,249.0156 L514,239.0156 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="324" y="257.5107">Broadcast P1a to all Acceptors.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="328" y="273.8623"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="324" y="290.2139">This activation corresponds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="324" y="306.5654">to the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="361" y="306.5654">"Scouts"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="419" y="306.5654">part.</text><polygon fill="#A80036" points="667,341.7734,677,345.7734,667,349.7734,671,345.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="428" x2="673" y1="345.7734" y2="345.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="435" y="340.917">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="446" y="340.917">P1a &lt;ballot&gt;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="721" y1="382.8008" y2="382.8008"/><line style="stroke:#A80036;stroke-width:1.0;" x1="721" x2="721" y1="382.8008" y2="395.8008"/><line style="stroke:#A80036;stroke-width:1.0;" x1="680" x2="721" y1="395.8008" y2="395.8008"/><polygon fill="#A80036" points="690,391.8008,680,395.8008,690,399.8008,686,395.8008" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="686" y="377.9443">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="697" y="377.9443">Update my_ballot</text><path d="M810,358.7734 L810,400.7734 L982,400.7734 L982,368.7734 L972,358.7734 L810,358.7734 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M972,358.7734 L972,368.7734 L982,368.7734 L972,358.7734 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="816" y="377.2686">if msg_ballot &gt; my_ballot:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="832" y="393.6201">my_ballot = msg_ballot</text><polygon fill="#A80036" points="434,466.5313,424,470.5313,434,474.5313,430,470.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="428" x2="678" y1="470.5313" y2="470.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="440" y="465.6748">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="451" y="465.6748">P1b &lt;ballot, accepted[]&gt;</text><path d="M684,415.4766 L684,506.4766 L941,506.4766 L941,425.4766 L931,415.4766 L684,415.4766 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M931,415.4766 L931,425.4766 L941,425.4766 L931,415.4766 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="690" y="433.9717">"accepted"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="760" y="433.9717">, is a collection of</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="46" x="866" y="433.9717">PValue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="912" y="433.9717">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="690" y="450.3232">A</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="46" x="703" y="450.3232">PValue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="753" y="450.3232">consists of: &lt;slot, ballot, req&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="694" y="466.6748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="690" y="483.0264">That collection is appended to during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="690" y="499.3779">Phase 2 on P2a.</text><path d="M309,530.2344 L370,530.2344 L370,538.2344 L360,548.2344 L309,548.2344 L309,530.2344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="419.8672" style="stroke:#000000;stroke-width:2.0;" width="632" x="309" y="530.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="324" y="544.7295">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="340" x="385" y="543.6533">[At least ONE msg received with Ballot greater than my_ballot]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423" x2="465" y1="570.9375" y2="570.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465" x2="465" y1="570.9375" y2="583.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424" x2="465" y1="583.9375" y2="583.9375"/><polygon fill="#A80036" points="434,579.9375,424,583.9375,434,587.9375,430,583.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="430" y="566.0811">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="441" y="566.0811">Preempted &lt;ballot&gt;</text><path d="M319,596.9375 L319,736.9375 L523,736.9375 L523,606.9375 L513,596.9375 L319,596.9375 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M513,596.9375 L513,606.9375 L523,606.9375 L513,596.9375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="325" y="615.4326">On PreemptedMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="329" y="631.7842"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="325" y="648.1357">if msg.ballot &gt; my_ballot:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="341" y="664.4873"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="341" y="664.4873">my_ballot = msg.ballot + 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="341" y="680.8389">Go back to phase 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="329" y="697.1904"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="325" y="713.542">This Leader no longer Active</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="325" y="729.8936">BECOME A FOLLOWER</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="309" x2="941" y1="747.75" y2="747.75"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="399" x="314" y="759.1689">[At least half responses received with no Ballot greater than my_ballot?]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423" x2="465" y1="857.0195" y2="857.0195"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465" x2="465" y1="857.0195" y2="870.0195"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424" x2="465" y1="870.0195" y2="870.0195"/><polygon fill="#A80036" points="434,866.0195,424,870.0195,434,874.0195,430,870.0195" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="430" y="852.1631">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="441" y="852.1631">Adopted &lt;ballot, accepted[]&gt;</text><path d="M621,767.5859 L621,940.5859 L922,940.5859 L922,777.5859 L912,767.5859 L621,767.5859 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M912,767.5859 L912,777.5859 L922,777.5859 L912,767.5859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="134" x="627" y="786.0811">On AdoptedMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="631" y="802.4326"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="627" y="818.7842">if my_ballot == msg_ballot</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="643" y="835.1357">foreach pvalue in msg.accepted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="659" y="851.4873">choose command with highest slot number</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="659" y="867.8389">Store it into proposals.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="643" y="884.1904">Start Phase 2 with all Pvalues.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="643" y="900.542">(Might receive Preempted msg here)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="631" y="916.8936"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="244" x="627" y="933.2451">BECOME THE DISTINGUISHED LEADER</text><rect fill="#EEEEEE" filter="url(#faean7l67dzxi)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1011" x="0" y="1006.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1011" y1="1006.2773" y2="1006.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1011" y1="1009.2773" y2="1009.2773"/><rect fill="#EEEEEE" filter="url(#faean7l67dzxi)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="73" x="469" y="995.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="475" y="1012.5967">PHASE 2</text><polygon fill="#A80036" points="240,1047.8047,250,1051.8047,240,1055.8047,244,1051.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61" x2="246" y1="1051.8047" y2="1051.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="68" y="1046.9482">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="79" y="1046.9482">Request &lt;id, seq, cmd&gt;</text><path d="M203,1064.8047 L203,1090.8047 L296,1090.8047 L296,1074.8047 L286,1064.8047 L203,1064.8047 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M286,1064.8047 L286,1074.8047 L296,1074.8047 L286,1064.8047 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="209" y="1083.2998">slot_in += 1</text><polygon fill="#A80036" points="411,1118.5078,421,1122.5078,411,1126.5078,415,1122.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252" x2="417" y1="1122.5078" y2="1122.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="259" y="1117.6514">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="270" y="1117.6514">Propose &lt;slot, req&gt;</text><path d="M10,1137.5078 L71,1137.5078 L71,1145.5078 L61,1155.5078 L10,1155.5078 L10,1137.5078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="934.1406" style="stroke:#000000;stroke-width:2.0;" width="912" x="10" y="1137.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="1152.0029">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="178" x="86" y="1150.9268">[slot NOT in Leader's proposals]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423" x2="465" y1="1178.2109" y2="1178.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465" x2="465" y1="1178.2109" y2="1191.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424" x2="465" y1="1191.2109" y2="1191.2109"/><polygon fill="#A80036" points="434,1187.2109,424,1191.2109,434,1195.2109,430,1191.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="430" y="1173.3545">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="441" y="1173.3545">Add (slot -&gt; req) entry to proposals map</text><path d="M20,1206.2109 L81,1206.2109 L81,1214.2109 L71,1224.2109 L20,1224.2109 L20,1206.2109 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="858.4375" style="stroke:#000000;stroke-width:2.0;" width="892" x="20" y="1206.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1220.7061">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="141" x="96" y="1219.6299">[if DISTINGUISHED LEADER]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423" x2="470" y1="1241.9141" y2="1241.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470" x2="470" y1="1241.9141" y2="1254.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="429" x2="470" y1="1254.9141" y2="1254.9141"/><polygon fill="#A80036" points="439,1250.9141,429,1254.9141,439,1258.9141,435,1254.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="435" y="1237.0576">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="453" y="1237.0576">Activate "Commander" stage</text><path d="M308,1274.9141 L381,1274.9141 L381,1282.9141 L371,1292.9141 L308,1292.9141 L308,1274.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="270.5156" style="stroke:#000000;stroke-width:2.0;" width="594" x="308" y="1274.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="323" y="1289.4092">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="387" x="396" y="1288.333">[until at least half responses no greater than my ballot OR any greater]</text><path d="M318,1298.2656 L318,1373.2656 L524,1373.2656 L524,1308.2656 L514,1298.2656 L318,1298.2656 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,1298.2656 L514,1308.2656 L524,1308.2656 L514,1298.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="324" y="1316.7607">Broadcast P2a to all Acceptors.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="328" y="1333.1123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="324" y="1349.4639">This activation corresponds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="324" y="1365.8154">to the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="96" x="361" y="1365.8154">"Commanders"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="461" y="1365.8154">part.</text><polygon fill="#A80036" points="667,1414.1992,677,1418.1992,667,1422.1992,671,1418.1992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="428" x2="673" y1="1418.1992" y2="1418.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="435" y="1413.3428">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="453" y="1413.3428">P2a &lt;Pvalue&gt;</text><path d="M684,1387.6719 L684,1429.6719 L831,1429.6719 L831,1397.6719 L821,1387.6719 L684,1387.6719 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M821,1387.6719 L821,1397.6719 L831,1397.6719 L821,1387.6719 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="690" y="1406.167">A</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="46" x="703" y="1406.167">PValue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="753" y="1406.167">consists of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="690" y="1422.5186">&lt;slot, ballot, req&gt;</text><path d="M630,1446.375 L691,1446.375 L691,1454.375 L681,1464.375 L630,1464.375 L630,1446.375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="262" x="630" y="1446.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="645" y="1460.8701">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="706" y="1459.7939">[if msg.ballot == my_ballot]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="679" x2="721" y1="1487.0781" y2="1487.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="721" x2="721" y1="1487.0781" y2="1500.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="680" x2="721" y1="1500.0781" y2="1500.0781"/><polygon fill="#A80036" points="690,1496.0781,680,1500.0781,690,1504.0781,686,1500.0781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="686" y="1482.2217">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="704" y="1482.2217">Add Pvalue to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="788" y="1482.2217">"accepted"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="862" y="1482.2217">set</text><polygon fill="#A80036" points="434,1533.4297,424,1537.4297,434,1541.4297,430,1537.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="428" x2="678" y1="1537.4297" y2="1537.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="440" y="1532.5732">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="458" y="1532.5732">P2b &lt;ballot, slot&gt;</text><path d="M30,1559.4297 L91,1559.4297 L91,1567.4297 L81,1577.4297 L30,1577.4297 L30,1559.4297 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="498.2188" style="stroke:#000000;stroke-width:2.0;" width="544" x="30" y="1559.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="45" y="1573.9248">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="340" x="106" y="1572.8486">[At least ONE msg received with Ballot greater than my_ballot]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423" x2="465" y1="1600.1328" y2="1600.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465" x2="465" y1="1600.1328" y2="1613.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424" x2="465" y1="1613.1328" y2="1613.1328"/><polygon fill="#A80036" points="434,1609.1328,424,1613.1328,434,1617.1328,430,1613.1328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="430" y="1595.2764">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="448" y="1595.2764">Preempted &lt;ballot&gt;</text><path d="M319,1626.1328 L319,1766.1328 L523,1766.1328 L523,1636.1328 L513,1626.1328 L319,1626.1328 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M513,1626.1328 L513,1636.1328 L523,1636.1328 L513,1626.1328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="325" y="1644.6279">On PreemptedMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="329" y="1660.9795"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="325" y="1677.3311">if msg.ballot &gt; my_ballot:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="341" y="1693.6826"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="341" y="1693.6826">my_ballot = msg.ballot + 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="341" y="1710.0342">Go back to phase 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="329" y="1726.3857"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="325" y="1742.7373">This Leader no longer Active</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="325" y="1759.0889">BECOME A FOLLOWER</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="574" y1="1776.9453" y2="1776.9453"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="399" x="35" y="1788.3643">[At least half responses received with no Ballot greater than my_ballot?]</text><polygon fill="#A80036" points="263,1810.1328,253,1814.1328,263,1818.1328,259,1814.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="257" x2="422" y1="1814.1328" y2="1814.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="269" y="1809.2764">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="287" y="1809.2764">Decision &lt;slot, req&gt;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="252" x2="294" y1="1851.1602" y2="1851.1602"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294" x2="294" y1="1851.1602" y2="1864.1602"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="294" y1="1864.1602" y2="1864.1602"/><polygon fill="#A80036" points="263,1860.1602,253,1864.1602,263,1868.1602,259,1864.1602" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="259" y="1846.3037">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="277" y="1846.3037">Register PaxosDecision</text><path d="M64,1827.1328 L64,1869.1328 L243,1869.1328 L243,1837.1328 L233,1827.1328 L64,1827.1328 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M233,1827.1328 L233,1837.1328 L243,1837.1328 L233,1827.1328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="70" y="1845.6279">PaxosDecision consists of:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="70" y="1861.9795">&lt;id, seq, cmd&gt;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="252" x2="294" y1="1924.2148" y2="1924.2148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294" x2="294" y1="1924.2148" y2="1937.2148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="294" y1="1937.2148" y2="1937.2148"/><polygon fill="#A80036" points="263,1933.2148,253,1937.2148,263,1941.2148,259,1937.2148" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="259" y="1919.3584">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="277" y="1919.3584">Perform command</text><path d="M92,1883.8359 L92,1958.8359 L243,1958.8359 L243,1893.8359 L233,1883.8359 L92,1883.8359 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M233,1883.8359 L233,1893.8359 L243,1893.8359 L233,1883.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="98" y="1902.3311">Apply state change on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="98" y="1918.6826">the KV store.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="102" y="1935.0342"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="80" x="98" y="1951.3857">slot_out += 1</text><polygon fill="#A80036" points="72,2016.1211,62,2020.1211,72,2024.1211,68,2020.1211" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="66" x2="251" y1="2020.1211" y2="2020.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="78" y="2015.2646">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="96" y="2015.2646">Reply &lt;id, seq, result&gt;</text><path d="M257,1973.2422 L257,2048.2422 L399,2048.2422 L399,1983.2422 L389,1973.2422 L257,1973.2422 " fill="#FBFB77" filter="url(#faean7l67dzxi)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M389,1973.2422 L389,1983.2422 L399,1983.2422 L389,1973.2422 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="263" y="1991.7373">Finally, reply back to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="263" y="2008.0889">the Client.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="267" y="2024.4404"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="26" x="263" y="2040.792">END</text><!--MD5=[68a40ce2e30030575786b75aed9913f1]
@startuml PAXOS

autonumber
box "PaxosClient" #LightBlue
    actor Client
end box
box "PaxosServer" #LightGreen
    collections "Replica" as Replica
    collections "Leader" as Leader
    collections "Acceptor" as Acceptor
end box


== PHASE 1 ==

Leader -> Leader : Activate "Scout" stage.

activate Leader

loop until at least half responses no greater than my ballot OR any greater
    note over Leader
        Broadcast P1a to all Acceptors.

        This activation corresponds
        to the **"Scouts"** part.
    end note

    Leader -> Acceptor : P1a <ballot>

    Acceptor -> Acceptor : Update my_ballot
    note right
        if msg_ballot > my_ballot:
            my_ballot = msg_ballot
    end note

    Acceptor -> Leader : P1b <ballot, accepted[]>
    note right
        **"accepted"**, is a collection of **PValue**.
        A **PValue** consists of: <slot, ballot, req>
        
        That collection is appended to during
        Phase 2 on P2a.
    end note

    deactivate Leader
end

alt At least ONE msg received with Ballot greater than my_ballot
    Leader -> Leader : Preempted <ballot>
    note over Leader
        **On PreemptedMessage:**

        if msg.ballot > my_ballot:
            **my_ballot = msg.ballot + 1**
            Go back to phase 1

        This Leader no longer Active
        **BECOME A FOLLOWER**
    end note
else At least half responses received with no Ballot greater than my_ballot?
    Leader -> Leader : Adopted <ballot, accepted[]>
    note right
        **On AdoptedMessage:**

        if my_ballot == msg_ballot
            foreach pvalue in msg.accepted
                choose command with highest slot number
                Store it into proposals.
            Start Phase 2 with all Pvalues.
            (Might receive Preempted msg here)

        **BECOME THE DISTINGUISHED LEADER**
    end note
end


...

== PHASE 2 ==

Client -> Replica : Request <id, seq, cmd>
note over Replica
    **slot_in += 1**
end note

Replica -> Leader : Propose <slot, req>

alt slot NOT in Leader's proposals
    Leader -> Leader : Add (slot -> req) entry to proposals map

    alt if DISTINGUISHED LEADER
        Leader -> Leader : Activate "Commander" stage
        activate Leader

        loop until at least half responses no greater than my ballot OR any greater
            note over Leader
                Broadcast P2a to all Acceptors.

                This activation corresponds
                to the **"Commanders"** part.
            end note

            Leader -> Acceptor : P2a <Pvalue>
            note right
                A **PValue** consists of
                <slot, ballot, req>
            end note

            alt if msg.ballot == my_ballot
                Acceptor -> Acceptor : Add Pvalue to **"accepted"** set
            end


            Acceptor -> Leader : P2b <ballot, slot>

            deactivate Leader
        end

        alt At least ONE msg received with Ballot greater than my_ballot
            Leader -> Leader : Preempted <ballot>

            note over Leader
                **On PreemptedMessage:**

                if msg.ballot > my_ballot:
                    **my_ballot = msg.ballot + 1**
                    Go back to phase 1

                This Leader no longer Active
                **BECOME A FOLLOWER**
            end note
        else At least half responses received with no Ballot greater than my_ballot?
            Leader -> Replica : Decision <slot, req>

            Replica -> Replica : Register PaxosDecision
            note left
                PaxosDecision consists of:
                <id, seq, cmd>
            end note

            Replica -> Replica : Perform command
            note left
                Apply state change on
                the KV store.

                **slot_out += 1**
            end note

            Replica -> Client : Reply <id, seq, result>
            note right
                Finally, reply back to
                the Client.

                **END**
            end note
        end
    end
end

@enduml

PlantUML version 1.2021.7(Sun May 23 06:40:07 CST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>