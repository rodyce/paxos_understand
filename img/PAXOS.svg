<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1976px" preserveAspectRatio="none" style="width:960px;height:1976px;background:#FFFFFF;" version="1.1" viewBox="0 0 960 1976" width="960px" zoomAndPan="magnify"><defs><filter height="300%" id="foqgzwxqz7ezq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="1964.4453" style="stroke:#A80036;stroke-width:1.0;" width="82" x="1" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76" x="4" y="19.4951">PaxosClient</text><rect fill="#90EE90" height="1964.4453" style="stroke:#A80036;stroke-width:1.0;" width="521.5" x="194.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81" x="414.75" y="19.4951">PaxosServer</text><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="89.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="412" y="299.2461"/><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="197.1641" style="stroke:#000000;stroke-width:2.0;" width="569.5" x="373.5" y="245.3672"/><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="463.2188" style="stroke:#000000;stroke-width:2.0;" width="369" x="254" y="456.5313"/><rect fill="#FFFFFF" height="214" style="stroke:none;stroke-width:1.0;" width="369" x="254" y="705.75"/><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="638.9219" style="stroke:#000000;stroke-width:2.0;" width="740.5" x="168.5" y="1107.1563"/><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="490.1641" style="stroke:#000000;stroke-width:2.0;" width="720.5" x="178.5" y="1248.9141"/><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="181.1094" style="stroke:#000000;stroke-width:2.0;" width="515.5" x="373.5" y="1274.2656"/><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="255" x="624" y="1356.3203"/><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="262.7031" style="stroke:#000000;stroke-width:2.0;" width="379.5" x="188.5" y="1469.375"/><rect fill="#FFFFFF" height="214" style="stroke:none;stroke-width:1.0;" width="379.5" x="188.5" y="1518.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42" x2="42" y1="110.9609" y2="926.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="42" x2="42" y1="926.75" y2="954.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42" x2="42" y1="954.75" y2="1882.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="232.5" x2="232.5" y1="110.9609" y2="926.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="232.5" x2="232.5" y1="926.75" y2="954.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="232.5" x2="232.5" y1="954.75" y2="1882.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="416.5" x2="416.5" y1="110.9609" y2="926.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="416.5" x2="416.5" y1="926.75" y2="954.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="416.5" x2="416.5" y1="954.75" y2="1882.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="673" x2="673" y1="110.9609" y2="926.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="673" x2="673" y1="926.75" y2="954.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="673" x2="673" y1="954.75" y2="1882.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="21" y="107.8848">Client</text><ellipse cx="42" cy="36.3516" fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M42,44.3516 L42,71.3516 M29,52.3516 L55,52.3516 M42,71.3516 L29,86.3516 M42,71.3516 L55,86.3516 " fill="none" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="21" y="1896.3691">Client</text><ellipse cx="42" cy="1909.4453" fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M42,1917.4453 L42,1944.4453 M29,1925.4453 L55,1925.4453 M42,1944.4453 L29,1959.4453 M42,1944.4453 L55,1959.4453 " fill="none" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="202.5" y="70.3516"/><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="198.5" y="74.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="205.5" y="95.8848">Replica</text><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="202.5" y="1881.8359"/><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="61" x="198.5" y="1885.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="205.5" y="1907.3691">Replica</text><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="387.5" y="70.3516"/><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="383.5" y="74.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="390.5" y="95.8848">Leader</text><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="387.5" y="1881.8359"/><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="59" x="383.5" y="1885.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="390.5" y="1907.3691">Leader</text><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="638" y="70.3516"/><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="634" y="74.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="641" y="95.8848">Acceptor</text><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="638" y="1881.8359"/><rect fill="#FEFECE" filter="url(#foqgzwxqz7ezq)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="70" x="634" y="1885.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="641" y="1907.3691">Acceptor</text><rect fill="#FFFFFF" filter="url(#foqgzwxqz7ezq)" height="89.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="412" y="299.2461"/><rect fill="#EEEEEE" filter="url(#foqgzwxqz7ezq)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="953" x="0" y="142.1367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="953" y1="142.1367" y2="142.1367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="953" y1="145.1367" y2="145.1367"/><rect fill="#EEEEEE" filter="url(#foqgzwxqz7ezq)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="73" x="440" y="130.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="446" y="148.4561">PHASE 1</text><path d="M301,170.3125 L301,229.3125 L529,229.3125 L529,180.3125 L519,170.3125 L301,170.3125 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M519,170.3125 L519,180.3125 L529,180.3125 L519,170.3125 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="307" y="188.8076">Broadcast P1a to all Acceptors.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="307" y="205.1592">The following activation corresponds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="307" y="221.5107">to the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="344" y="221.5107">"Scouts"</text><path d="M373.5,245.3672 L446.5,245.3672 L446.5,253.3672 L436.5,263.3672 L373.5,263.3672 L373.5,245.3672 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="197.1641" style="stroke:#000000;stroke-width:2.0;" width="569.5" x="373.5" y="245.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="388.5" y="259.8623">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="387" x="461.5" y="258.7861">[until at least half responses no greater than my ballot OR any greater]</text><polygon fill="#A80036" points="661,295.2461,671,299.2461,661,303.2461,665,299.2461" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422" x2="667" y1="299.2461" y2="299.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="429" y="294.3896">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="440" y="294.3896">P1a &lt;ballot&gt;</text><path d="M678,268.7188 L678,310.7188 L850,310.7188 L850,278.7188 L840,268.7188 L678,268.7188 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M840,268.7188 L840,278.7188 L850,278.7188 L840,268.7188 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="684" y="287.2139">if msg_ballot &gt; my_ballot:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="700" y="303.5654">my_ballot = msg_ballot</text><polygon fill="#A80036" points="428,384.6523,418,388.6523,428,392.6523,424,388.6523" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422" x2="672" y1="388.6523" y2="388.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="434" y="383.7959">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="445" y="383.7959">P1b &lt;ballot, accepted[]&gt;</text><path d="M678,325.4219 L678,433.4219 L924,433.4219 L924,335.4219 L914,325.4219 L678,325.4219 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M914,325.4219 L914,335.4219 L924,335.4219 L914,325.4219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="684" y="343.917">"Accepted"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="755" y="343.917">, in P1b message is a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="684" y="360.2686">collection of PValues. This collection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="684" y="376.6201">is appended to during Phase 2 on P2a.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="688" y="392.9717"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="684" y="409.3232">A</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="46" x="697" y="409.3232">PValue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="747" y="409.3232">consists of:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="684" y="425.6748">&lt;slot, ballot, req&gt;</text><path d="M254,456.5313 L315,456.5313 L315,464.5313 L305,474.5313 L254,474.5313 L254,456.5313 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="463.2188" style="stroke:#000000;stroke-width:2.0;" width="369" x="254" y="456.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="269" y="471.0264">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="288" x="330" y="469.9502">[At least half responses no greater than my_ballot?]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="417" x2="459" y1="497.2344" y2="497.2344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="459" x2="459" y1="497.2344" y2="510.2344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="418" x2="459" y1="510.2344" y2="510.2344"/><polygon fill="#A80036" points="428,506.2344,418,510.2344,428,514.2344,424,510.2344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="424" y="492.3779">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="435" y="492.3779">Adopted &lt;ballot, accepted[]&gt;</text><path d="M264,523.2344 L264,696.2344 L565,696.2344 L565,533.2344 L555,523.2344 L264,523.2344 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M555,523.2344 L555,533.2344 L565,533.2344 L555,523.2344 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="134" x="270" y="541.7295">On AdoptedMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="274" y="558.0811"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="270" y="574.4326">if my_ballot == msg_ballot</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="286" y="590.7842">foreach pvalue in msg.accepted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="302" y="607.1357">choose command with highest slot number</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="302" y="623.4873">Store it into proposals.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="286" y="639.8389">Start Phase 2 with all Pvalues.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="286" y="656.1904">(Might receive Preempted msg here)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="274" y="672.542"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="244" x="270" y="688.8936">BECOME THE DISTINGUISHED LEADER</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="254" x2="623" y1="706.75" y2="706.75"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="333" x="259" y="718.1689">[At least one msg received with grater ballot than my_ballot]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="417" x2="459" y1="743.9375" y2="743.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="459" x2="459" y1="743.9375" y2="756.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="418" x2="459" y1="756.9375" y2="756.9375"/><polygon fill="#A80036" points="428,752.9375,418,756.9375,428,760.9375,424,756.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="424" y="739.0811">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="435" y="739.0811">Preempted &lt;ballot&gt;</text><path d="M313,769.9375 L313,909.9375 L517,909.9375 L517,779.9375 L507,769.9375 L313,769.9375 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M507,769.9375 L507,779.9375 L517,779.9375 L507,769.9375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="319" y="788.4326">On PreemptedMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="323" y="804.7842"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="319" y="821.1357">if msg.ballot &gt; my_ballot:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="335" y="837.4873"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="335" y="837.4873">my_ballot = msg.ballot + 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="335" y="853.8389">Go back to phase 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="323" y="870.1904"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="319" y="886.542">This Leader no longer Active</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="319" y="902.8936">BECOME A FOLLOWER</text><rect fill="#EEEEEE" filter="url(#foqgzwxqz7ezq)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="953" x="0" y="975.9258"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="953" y1="975.9258" y2="975.9258"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="953" y1="978.9258" y2="978.9258"/><rect fill="#EEEEEE" filter="url(#foqgzwxqz7ezq)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="73" x="440" y="964.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="446" y="982.2451">PHASE 2</text><polygon fill="#A80036" points="221,1017.4531,231,1021.4531,221,1025.4531,225,1021.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42" x2="227" y1="1021.4531" y2="1021.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="49" y="1016.5967">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="60" y="1016.5967">Request &lt;id, seq, cmd&gt;</text><path d="M184,1034.4531 L184,1060.4531 L277,1060.4531 L277,1044.4531 L267,1034.4531 L184,1034.4531 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M267,1034.4531 L267,1044.4531 L277,1044.4531 L267,1034.4531 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="190" y="1052.9482">slot_in += 1</text><polygon fill="#A80036" points="405,1088.1563,415,1092.1563,405,1096.1563,409,1092.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="233" x2="411" y1="1092.1563" y2="1092.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="240" y="1087.2998">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="251" y="1087.2998">Propose &lt;slot, req&gt;</text><path d="M168.5,1107.1563 L229.5,1107.1563 L229.5,1115.1563 L219.5,1125.1563 L168.5,1125.1563 L168.5,1107.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="638.9219" style="stroke:#000000;stroke-width:2.0;" width="740.5" x="168.5" y="1107.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="183.5" y="1121.6514">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="178" x="244.5" y="1120.5752">[slot NOT in Leader's proposals]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="417" x2="459" y1="1147.8594" y2="1147.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="459" x2="459" y1="1147.8594" y2="1160.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="418" x2="459" y1="1160.8594" y2="1160.8594"/><polygon fill="#A80036" points="428,1156.8594,418,1160.8594,428,1164.8594,424,1160.8594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="424" y="1143.0029">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="435" y="1143.0029">Add (slot -&gt; req) entry to proposals map</text><path d="M301,1173.8594 L301,1232.8594 L529,1232.8594 L529,1183.8594 L519,1173.8594 L301,1173.8594 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M519,1173.8594 L519,1183.8594 L529,1183.8594 L519,1173.8594 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="307" y="1192.3545">Broadcast P2a to all Acceptors.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="307" y="1208.7061">The following activation corresponds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="307" y="1225.0576">to the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="96" x="344" y="1225.0576">"Commanders"</text><path d="M178.5,1248.9141 L239.5,1248.9141 L239.5,1256.9141 L229.5,1266.9141 L178.5,1266.9141 L178.5,1248.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="490.1641" style="stroke:#000000;stroke-width:2.0;" width="720.5" x="178.5" y="1248.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="193.5" y="1263.4092">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="141" x="254.5" y="1262.333">[if DISTINGUISHED LEADER]</text><path d="M373.5,1274.2656 L446.5,1274.2656 L446.5,1282.2656 L436.5,1292.2656 L373.5,1292.2656 L373.5,1274.2656 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="181.1094" style="stroke:#000000;stroke-width:2.0;" width="515.5" x="373.5" y="1274.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="388.5" y="1288.7607">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="387" x="461.5" y="1287.6846">[until at least half responses no greater than my ballot OR any greater]</text><polygon fill="#A80036" points="661,1324.1445,671,1328.1445,661,1332.1445,665,1328.1445" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="417" x2="667" y1="1328.1445" y2="1328.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="424" y="1323.2881">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="435" y="1323.2881">P2a &lt;Pvalue&gt;</text><path d="M678,1297.6172 L678,1339.6172 L825,1339.6172 L825,1307.6172 L815,1297.6172 L678,1297.6172 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M815,1297.6172 L815,1307.6172 L825,1307.6172 L815,1297.6172 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="684" y="1316.1123">A</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="46" x="697" y="1316.1123">PValue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="747" y="1316.1123">consists of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="684" y="1332.4639">&lt;slot, ballot, req&gt;</text><path d="M624,1356.3203 L685,1356.3203 L685,1364.3203 L675,1374.3203 L624,1374.3203 L624,1356.3203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="255" x="624" y="1356.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="639" y="1370.8154">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="700" y="1369.7393">[if msg.ballot == my_ballot]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="673" x2="715" y1="1397.0234" y2="1397.0234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="715" x2="715" y1="1397.0234" y2="1410.0234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="674" x2="715" y1="1410.0234" y2="1410.0234"/><polygon fill="#A80036" points="684,1406.0234,674,1410.0234,684,1414.0234,680,1410.0234" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="680" y="1392.167">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="691" y="1392.167">Add Pvalue to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="775" y="1392.167">"accepted"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="849" y="1392.167">set</text><polygon fill="#A80036" points="428,1443.375,418,1447.375,428,1451.375,424,1447.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422" x2="672" y1="1447.375" y2="1447.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="434" y="1442.5186">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="452" y="1442.5186">P2b &lt;ballot, slot&gt;</text><path d="M188.5,1469.375 L249.5,1469.375 L249.5,1477.375 L239.5,1487.375 L188.5,1487.375 L188.5,1469.375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="262.7031" style="stroke:#000000;stroke-width:2.0;" width="379.5" x="188.5" y="1469.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="203.5" y="1483.8701">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="288" x="264.5" y="1482.7939">[At least half responses no greater than my_ballot?]</text><polygon fill="#A80036" points="244,1506.0781,234,1510.0781,244,1514.0781,240,1510.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238" x2="416" y1="1510.0781" y2="1510.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="250" y="1505.2217">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="268" y="1505.2217">Decision &lt;id, seq, cmd&gt;</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="568" y1="1519.0781" y2="1519.0781"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="333" x="193.5" y="1530.4971">[At least one msg received with grater ballot than my_ballot]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="417" x2="459" y1="1556.2656" y2="1556.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="459" x2="459" y1="1556.2656" y2="1569.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="418" x2="459" y1="1569.2656" y2="1569.2656"/><polygon fill="#A80036" points="428,1565.2656,418,1569.2656,428,1573.2656,424,1569.2656" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="424" y="1551.4092">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="442" y="1551.4092">Preempted &lt;ballot&gt;</text><path d="M313,1582.2656 L313,1722.2656 L517,1722.2656 L517,1592.2656 L507,1582.2656 L313,1582.2656 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M507,1582.2656 L507,1592.2656 L517,1592.2656 L507,1582.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="319" y="1600.7607">On PreemptedMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="323" y="1617.1123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="319" y="1633.4639">if msg.ballot &gt; my_ballot:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="335" y="1649.8154"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="335" y="1649.8154">my_ballot = msg.ballot + 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="335" y="1666.167">Go back to phase 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="323" y="1682.5186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="319" y="1698.8701">This Leader no longer Active</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="319" y="1715.2217">BECOME A FOLLOWER</text><path d="M97,1758.0781 L97,1833.0781 L364,1833.0781 L364,1768.0781 L354,1758.0781 L97,1758.0781 " fill="#FBFB77" filter="url(#foqgzwxqz7ezq)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M354,1758.0781 L354,1768.0781 L364,1768.0781 L354,1758.0781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="103" y="1776.5732">Invoke perform()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="119" y="1792.9248">Perform command. Apply state change.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="107" y="1809.2764"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="80" x="103" y="1825.6279">slot_out += 1</text><polygon fill="#A80036" points="53,1860.8359,43,1864.8359,53,1868.8359,49,1864.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47" x2="232" y1="1864.8359" y2="1864.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="59" y="1859.9795">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="77" y="1859.9795">Reply &lt;id, seq, result&gt;</text><!--MD5=[d363f68522f14444e3fd95c2b8aedbc7]
@startuml PAXOS

autonumber
box "PaxosClient" #LightBlue
    actor Client
end box
box "PaxosServer" #LightGreen
    collections "Replica" as Replica
    collections "Leader" as Leader
    collections "Acceptor" as Acceptor
end box


== PHASE 1 ==

note over Leader
    Broadcast P1a to all Acceptors.
    The following activation corresponds
    to the **"Scouts"**
end note

loop until at least half responses no greater than my ballot OR any greater
    Leader -> Acceptor : P1a <ballot>
    note right
        if msg_ballot > my_ballot:
            my_ballot = msg_ballot
    end note

    activate Leader

    Acceptor -> Leader : P1b <ballot, accepted[]>
    note right
        **"Accepted"**, in P1b message is a
        collection of PValues. This collection
        is appended to during Phase 2 on P2a.

        A **PValue** consists of:
        <slot, ballot, req>
    end note

    deactivate Leader
end

alt At least half responses no greater than my_ballot?
    Leader -> Leader : Adopted <ballot, accepted[]>
    note over Leader
        **On AdoptedMessage:**

        if my_ballot == msg_ballot
            foreach pvalue in msg.accepted
                choose command with highest slot number
                Store it into proposals.
            Start Phase 2 with all Pvalues.
            (Might receive Preempted msg here)

        **BECOME THE DISTINGUISHED LEADER**
    end note
else At least one msg received with grater ballot than my_ballot
    Leader -> Leader : Preempted <ballot>
    note over Leader
        **On PreemptedMessage:**

        if msg.ballot > my_ballot:
            **my_ballot = msg.ballot + 1**
            Go back to phase 1

        This Leader no longer Active
        **BECOME A FOLLOWER**
    end note
end


...

== PHASE 2 ==

Client -> Replica : Request <id, seq, cmd>
note over Replica
    **slot_in += 1**
end note

Replica -> Leader : Propose <slot, req>

alt slot NOT in Leader's proposals
    Leader -> Leader : Add (slot -> req) entry to proposals map
    note over Leader
        Broadcast P2a to all Acceptors.
        The following activation corresponds
        to the **"Commanders"**
    end note

    alt if DISTINGUISHED LEADER
        loop until at least half responses no greater than my ballot OR any greater
            Leader -> Acceptor : P2a <Pvalue>
            note right
                A **PValue** consists of
                <slot, ballot, req>
            end note

            alt if msg.ballot == my_ballot
                Acceptor -> Acceptor : Add Pvalue to **"accepted"** set
            end

            activate Leader

            Acceptor -> Leader : P2b <ballot, slot>

            deactivate Leader
        end

        alt At least half responses no greater than my_ballot?
            Leader -> Replica : Decision <id, seq, cmd>
        else At least one msg received with grater ballot than my_ballot
            Leader -> Leader : Preempted <ballot>

            note over Leader
                **On PreemptedMessage:**

                if msg.ballot > my_ballot:
                    **my_ballot = msg.ballot + 1**
                    Go back to phase 1

                This Leader no longer Active
                **BECOME A FOLLOWER**
            end note
        end
    end
end

note over Replica
    Invoke perform()
        Perform command. Apply state change.

    **slot_out += 1**
end note

Replica -> Client : Reply <id, seq, result>

@enduml

PlantUML version 1.2021.7(Sun May 23 06:40:07 CST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>